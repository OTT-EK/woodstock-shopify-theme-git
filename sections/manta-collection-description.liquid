{% stylesheet %}
.manta-cl-description-section.page-width {
  margin-top: 10vh;
}
{% endstylesheet %}

{% assign show_full = section.settings.always_show_full %}

<section class="manta-cl-description-section page-width">
  {% if collection %}
    <h1 class="manta-cl-description-title">{{ collection.title }}</h1>

    {% if show_full %}
      <!-- Always show the full description -->
      <div class="manta-cl-description-content">
        {{ collection.description }}
      </div>
    {% else %}
      <!-- Collapsible description container -->
      <div class="manta-cl-description-content collapsed" id="manta-description-container">
        {{ collection.description }}
      </div>

      <!-- "Read more" button -->
      <button class="manta-cl-description-read-more" id="manta-description-readmore-btn">
        Read more
      </button>

      <!-- JavaScript to toggle expanded state -->
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          var content  = document.getElementById('manta-description-container');
          var btn      = document.getElementById('manta-description-readmore-btn');

          // If container is shorter than 40vh, hide the button and remove the "collapsed" styling
          var maxHeightPx = window.innerHeight * 0.4; // 40vh in px
          if (content.scrollHeight <= maxHeightPx) {
            btn.style.display = 'none';
            content.classList.remove('collapsed');
            content.style.maxHeight = 'none';
          } else {
            // Otherwise, set max-height and keep the fade
            content.style.maxHeight = maxHeightPx + 'px';
          }

          // Handle "Read more" click
          btn.addEventListener('click', function() {
            content.style.maxHeight = 'none'; 
            content.classList.remove('collapsed');
            btn.style.display = 'none';
          });
        });
      </script>

      <!-- Styles for fade effect -->
      <style>
        .manta-cl-description-content {
          /* basic spacing if needed */
          margin-bottom: 1rem;
          transition: max-height 0.3s ease;
        }

        .manta-cl-description-content.collapsed {
          position: relative;
          overflow: hidden;
        }

        /* The gradient fade from transparent to white (bottom fade) */
        .manta-cl-description-content.collapsed::after {
          content: "";
          position: absolute;
          left: 0; 
          right: 0; 
          bottom: 0;
          height: 4rem; /* adjust as desired */
          background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, #fff 80%);
        }
      </style>

    {% endif %}
  {% endif %}
</section>
