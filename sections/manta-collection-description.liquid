{% stylesheet %}
.manta-cl-description-section.page-width {
  margin-top: 10vh;
}
{% endstylesheet %}

{% assign show_full = section.settings.always_show_full %}

<section class="manta-cl-description-section page-width">
  {% if collection %}
    <h1 class="manta-cl-description-title">{{ collection.title }}</h1>

    {% if show_full %}
      <!-- Always show the full description -->
      <div class="manta-cl-description-content">
        {{ collection.description }}
      </div>
    {% else %}
      <!-- Collapsible description container -->
      <div class="manta-cl-description-content collapsed" id="manta-description-container">
        {{ collection.description }}
      </div>

      <!-- "Read more..." text link -->
      <span class="manta-cl-description-read-more" id="manta-description-readmore-link">
        Read more...
      </span>

      <!-- JavaScript to toggle expanded state -->
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          var content  = document.getElementById('manta-description-container');
          var readMore = document.getElementById('manta-description-readmore-link');
          var maxHeightPx = window.innerHeight * 0.4; // 40vh in px

          // If the container is shorter than 40vh, hide "Read more..." link and remove collapsed styling
          if (content.scrollHeight <= maxHeightPx) {
            readMore.style.display = 'none';
            content.classList.remove('collapsed');
            content.style.maxHeight = 'none';
          } else {
            // Otherwise, cap at 40vh and show the fade effect
            content.style.maxHeight = maxHeightPx + 'px';
          }

          // On "Read more..." click, expand
          readMore.addEventListener('click', function() {
            content.style.maxHeight = 'none';
            content.classList.remove('collapsed');
            readMore.style.display = 'none';
          });
        });
      </script>

      <!-- Styles for fade effect and link appearance -->
      <style>
        .manta-cl-description-content {
          margin-bottom: 1rem;
          transition: max-height 0.3s ease;
        }

        .manta-cl-description-content.collapsed {
          position: relative;
          overflow: hidden;
        }

        /* The gradient fade from transparent to white (bottom fade) */
        .manta-cl-description-content.collapsed::after {
          content: "";
          position: absolute;
          left: 0;
          right: 0;
          bottom: 0;
          height: 4rem; /* adjust as needed */
          background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, #fff 80%);
        }

        /* "Read more..." link styling */
        .manta-cl-description-read-more {
          display: inline-block; /* or block, if you prefer */
          cursor: pointer;
          text-decoration: underline;
          color: black;
          margin-bottom: 1.5rem;
        }
      </style>
    {% endif %}
  {% endif %}
</section>
