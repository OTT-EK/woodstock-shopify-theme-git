{% assign show_full = section.settings.always_show_full %}

<section class="manta-cl-description-section page-width">
  {% if collection %}
    <h1 class="manta-cl-description-title">{{ collection.title }}</h1>

    {% if show_full %}
      <!-- Always show the full description -->
      <div class="manta-cl-description-content" style="max-height:none; overflow:visible;">
        {{ collection.description }}
      </div>
    {% else %}
      <!-- Collapsible description container -->
      <div class="manta-cl-description-content manta-cl-desc-collapsed" id="manta-description-container">
        {{ collection.description }}
      </div>

      <!-- "Read more..." text link -->
      <span class="manta-cl-description-read-more" id="manta-description-readmore-link">
        Read more...
      </span>

      <!-- JavaScript to toggle expanded state with smooth transition -->
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          var content  = document.getElementById('manta-description-container');
          var readMore = document.getElementById('manta-description-readmore-link');
          
          // Convert 40vh to px
          var maxHeightPx = Math.round(window.innerHeight * 0.4);

          // If the content is shorter than 40vh, show it all & hide the "Read more..." link
          if (content.scrollHeight <= maxHeightPx) {
            content.classList.remove('manta-cl-desc-collapsed');
            content.style.maxHeight = 'none';
            readMore.style.display = 'none';
          } else {
            // Otherwise, cap at 40vh and show the fade
            content.style.maxHeight = maxHeightPx + 'px';
          }

          // When user clicks "Read more..."
          readMore.addEventListener('click', function() {
            // 1) Remove gradient fade
            content.classList.remove('manta-cl-desc-collapsed');
            // 2) Smoothly expand by setting maxHeight to scrollHeight
            content.style.maxHeight = content.scrollHeight + 'px';

            // 3) Once transition ends, set to "none"
            content.addEventListener('transitionend', function onTransitionEnd() {
              content.style.maxHeight = 'none';
              content.removeEventListener('transitionend', onTransitionEnd);
            });

            // Hide the link once user clicks
            readMore.style.display = 'none';
          });
        });
      </script>

      <!-- Styles for fade effect, link appearance, and smooth transition -->
      <style>
        .manta-cl-description-content {
          margin-bottom: 1rem;
          overflow: hidden;
          transition: max-height 0.4s ease;
        }

        .manta-cl-desc-collapsed {
          position: relative;
        }

        /* The gradient fade from transparent to white (bottom fade) */
        .manta-cl-desc-collapsed::after {
          content: "";
          position: absolute;
          left: 0;
          right: 0;
          bottom: 0;
          height: 4rem; /* adjust as needed */
          background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, #fff 80%);
        }

        /* "Read more..." link styling */
        .manta-cl-description-read-more {
          display: inline-block;
          cursor: pointer;
          text-decoration: underline;
          color: black;
          margin-bottom: 1.5rem;
        }
      </style>
    {% endif %}
  {% endif %}
</section>

{% schema %}
{
  "name": "Description table",
  "settings": [
    {
      "type": "checkbox",
      "id": "always_show_full",
      "label": "Always show full description",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "Description table"
    }
  ]
}
{% endschema %}
