{% comment %}
  Section: Collection Description with Optional Read More Toggle
{% endcomment %}

<section class="manta-cl-description-section">
    {% if collection %}
      <h1 class="manta-cl-description-title">{{ collection.title }}</h1>
  
      {% assign full_description = collection.description | strip_newlines %}
      {% assign paragraphs = full_description | split: '\n\n' %}
      {% assign paragraph_count = paragraphs.size %}
      {% assign char_count = full_description | size %}
  
      {% assign show_full = section.settings.always_show_full %}
  
      {% if show_full or (paragraph_count <= 2 and char_count <= 1000) %}
        <div class="manta-cl-description-content">
          {{ collection.description }}
        </div>
      {% else %}
        {% assign sentences = collection.description | split: '.' %}
        {% assign truncated_description = '' %}
        {% assign current_length = 0 %}
  
        {% for sentence in sentences %}
          {% assign sentence_plus_period = sentence | append: '.' %}
          {% assign current_length = current_length | plus: sentence_plus_period | size %}
          {% assign truncated_description = truncated_description | append: sentence_plus_period %}
  
          {% if current_length >= 1000 %}
            {% break %}
          {% endif %}
        {% endfor %}
  
        <div class="manta-cl-description-content">
          <div id="manta-cl-description-truncated">{{ truncated_description }}</div>
          <div id="manta-cl-description-full" style="display: none;">{{ collection.description }}</div>
          <button id="manta-cl-description-read-more-btn" onclick="mantaClToggleDescription()">Read more</button>
        </div>
  
        <script>
          function mantaClToggleDescription() {
            var truncated = document.getElementById('manta-cl-description-truncated');
            var full = document.getElementById('manta-cl-description-full');
            var btn = document.getElementById('manta-cl-description-read-more-btn');
  
            if (full.style.display === 'none') {
              truncated.style.display = 'none';
              full.style.display = 'block';
              btn.style.display = 'none';
            }
          }
        </script>
      {% endif %}
    {% endif %}
  </section>
  
  {% schema %}
  {
    "name": "Collection Description Toggle",
    "settings": [
      {
        "type": "checkbox",
        "id": "always_show_full",
        "label": "Always show full description",
        "default": false
      }
    ],
    "templates": ["collection"]
  }
  {% endschema %}
  