
<section
  id="section-{{ section.id }}"
  class="sub-collections-section">

  {%- assign subCollections = collection.metafields.custom.sub_collection_list -%}

  {% comment %}
    subCollections is now the list of referenced collections. 
    We only proceed if it's not null/blank and has at least 1 item.
  {% endcomment %}
  {% if subCollections and subCollections.size > 0 %}

    <!-- Desktop-only side menu -->
    <aside class="sub-collections__sidebar hidden-pocket hidden-lap">
      <div class="sub-collections__sidebar-inner">
        
        <!-- Current Collection Icon & Title -->
        {% if collection.metafields.custom.collection_icon %}
          <div class="sub-collections__current-icon">
            <img 
              src="{{ collection.metafields.custom.collection_icon | image_url: width: 64 }}"
              alt="{{ collection.title | escape }}"
              width="64"
              height="64" />
          </div>
        {% endif %}
        <h3 class="sub-collections__current-name">
          {{ collection.title }}
        </h3>

        <!-- Simple UL of sub-collection titles -->
        <ul class="sub-collections__sidebar-list">
          {% for subColl in subCollections %}
            <li>
              <a href="{{ subColl.url }}">
                {{ subColl.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
    </aside>

    <!-- Main grid of sub-collection images -->
    <div class="sub-collections__grid-container page-width">
      <div class="sub-collections__grid">
        {% for subColl in subCollections %}
          <div class="sub-collections__grid-item">
            <a
              class="sub-collections__link"
              href="{{ subColl.url }}"
              title="{{ subColl.title | escape }}">

              {% comment %}
                If subColl has a "collection_image" metafield 
                (i.e. subColl.metafields.custom.collection_image),
                display it:
              {% endcomment %}
              {% if subColl.metafields.custom.collection_image %}
                <div class="sub-collections__image-wrapper">
                  <img 
                    src="{{ subColl.metafields.custom.collection_image | image_url: width: 600 }}"
                    alt="{{ subColl.title | escape }}"
                    width="600"
                    height="auto" />
                </div>
              {% endif %}
              
              <div class="sub-collections__title">
                {{ subColl.title }}
              </div>
            </a>
          </div>
        {% endfor %}
      </div>
    </div>

  {% else %}
    <!-- Fallback if no sub-collections are found -->
    <div class="page-width">
      <p>No sub-collections found.</p>
    </div>
  {% endif %}
</section>

{% schema %}
{
  "name": "Sub-Collection Grid",
  "settings": [
    {
      "type": "header",
      "content": "Sub-Collections"
    },
    {
      "type": "text",
      "id": "info",
      "label": "Note",
      "default": "Displays sub-collections found in custom.sub_collection_list."
    }
  ]
}
{% endschema %}
